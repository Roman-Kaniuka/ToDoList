@using ToDoListDomain.Enum
@{
    ViewData["Title"] = "Home Page";
}
@*TODO #6 Верстаємо форму з полями вводу користувачем значень для "завдань"*@
<h4 class="mb-3 text-muted">Створення завдання</h4>
<form id="createTaskForm">
    <div class="mb-3">
        <label class="form-label">Назва задачі</label>
        <input name="name" type="text" class="form-control"/>
    </div>
    <label class="form-label">Пріоритет задачі</label>
    @*
    створюємо список "priority" з Enum який ми створювали за допомогою тега "asp-items="Html.GetEnumSelectList<Priority>()"
    *@
    <select name="priority" class="form-select mb-3" asp-items="Html.GetEnumSelectList<Priority>()"></select>

    <div class="mb-3">
        <label class="form-label">Опис завдання</label>
        <textarea name="description" type="text" class="form-control" rows="3"></textarea>
    </div>
    <button id="createTask" class="btn btn-primary">Створити</button>
</form>
@*TODO: #18 Додаємо табличку представлення даних на сторінці використовуючи сайт https://datatables.net/*@
<table class="table table-dark table-hover" id="taskTableId">
    <thead>
    <tr>
        <th>Назва</th>
        <th>Пріоритет</th>
        <th>Опис</th>
        <th>Готовність</th>
        <th>Дія</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

@*TODO: #7 для створення реагування на подію "клік" використовуємо бібліотеку JS "jQuery".  *@
@*
В секції "section Scripts" прописуємо всі скрипти *@

@section Scripts
{
    @*додаємо бібліотеку для роботи з табличкою з сайту https://datatables.net/*@
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    @*додаємо бібліотеку з сайту  https://sweetalert2.github.io/#download *@
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
    
    @*TODO: #19 За допомогою "jQuery" робимо запит до таблиці через  id="taskTableId"*@
    let dataTable = $('#taskTableId').DataTable({
    info:true, //загальна інформація про таблицю 
    serverSide:false, //якщо true то "sorting" та "paging" буде відбуватися на стороні сервера
    searching: false, //рядок пошуку
    paging: true, //к-сть елементів які буде показано
    sorting: false, //сортування
    
    });
    //Кнопка "Створити" має id="createTask", на цей id ми навісимо подію "клік"
        $('#createTask').on('click', function (e){  //для функції function () передали параметр "е" щоб потім викликати на ньому
            e.preventDefault();                     //цей метод який не обновляє значення полів після натиску на кнопку "Створити"
            //ajax-для відправки даних без перезавантаження сторінки
            $.ajax({
            
                type: 'POST', //тип запиту "РОST" для передачи даних 
                url: '@Url.Action("Create", "Task")',// в метод Action передаємо "Create"-метод дії / "Task"-контроллер
                data: $('#createTaskForm').serialize(), //дані які передаємо знаходяться в <form id="createTaskForm"> і за допомогою метода 
                                                        //.serialize() групуємо всі дані які в <form> </form>
                                                        
                @*TODO: #16 опрацьовуємо успішний та не успішний результати додавання задачи *@
                //якщо успішно було додано то буде така реакція.
                //за допомогою сайта https://sweetalert2.github.io/#download додаємо бібліотеку реакцій   
                                              
                success: function (response) {
                    Swal.fire({                    
                      title: 'Інформація',
                      text: response.description,                      
                      width: 600,
                      padding: '3em',
                      customClass: {
                        popup: 'custom-popup-class', //додали свій клас для стилізації
                      },
                      backdrop: `
                        rgba(0,0,123,0.4)
                        url("https://media.tenor.com/-AyTtMgs2mMAAAAi/nyan-cat-nyan.gif")
                        left top    
                        no-repeat
                      `
                    });
                },
                //якщо буде помилка то буде така реакція
                error: function (response) {
                     Swal.fire({
                        title: 'Інформація',
                        text: response.responseJSON.description,
                        icon: 'error',
                        confirmButtonText: 'Окей'
                     })
                }
            })
        });
    </script>

}